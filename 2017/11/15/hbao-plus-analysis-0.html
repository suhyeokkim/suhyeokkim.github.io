<!DOCTYPE html>
<html lang="ko">

  <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_SVG"></script>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Hbao Plus Analysis 0</title>
  <meta name="description" content="게임에서 쓰이는 실시간 렌더링에서 빛과 물체들의 상호작용을 완벽하게 현실적으로 표현하는 거의 불가능하다. 하지만 이를 위해 수십년동안 많은 엔지니어와 연구자들이 노력하여 부분적이고 제한된 환경에서의 빛과 물체의 상호작용을 현실 세계와 비슷하게 따라잡고 있다. 이번 글에서 살펴볼 것은 Screen-Space Ambient Occlusion(SSAO) 기반의 HBAO+ 라는 라이브러리에 대해서 알아볼 것이다.">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://hrmrzizon.github.io/2017/11/15/hbao-plus-analysis-0">
  
  
  <link rel="alternate" type="application/rss+xml" title="Appocrypha" href="https://hrmrzizon.github.io/feed.xml">

  <meta name="google-site-verification" content="o3-a11YI0ZIYwUdcikrWBRObGOUHzk89IJF7CX0ieQk" />

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Hbao Plus Analysis 0">
  <meta name="twitter:description" content="게임에서 쓰이는 실시간 렌더링에서 빛과 물체들의 상호작용을 완벽하게 현실적으로 표현하는 거의 불가능하다. 하지만 이를 위해 수십년동안 많은 엔지니어와 연구자들이 노력하여 부분적이고 제한된 환경에서의 빛과 물체의 상호작용을 현실 세계와 비슷하게 따라잡고 있다. 이번 글에서 살펴볼 것은 Screen-Space Ambient Occlusion(SSAO) 기...">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-93000374-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Appocrypha</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/edu">Edu</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Hbao Plus Analysis 0</h1>
    
    <p class="post-meta"><time datetime="2017-11-15T00:00:00+00:00" itemprop="datePublished">Nov 15, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Su-Hyeok Kim</span></span> • 
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/render/">render</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/analysis/">analysis</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/hbao/">hbao+</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>게임에서 쓰이는 실시간 렌더링에서 빛과 물체들의 상호작용을 완벽하게 현실적으로 표현하는 거의 불가능하다. 하지만 이를 위해 수십년동안 많은 엔지니어와 연구자들이 노력하여 부분적이고 제한된 환경에서의 빛과 물체의 상호작용을 현실 세계와 비슷하게 따라잡고 있다. 이번 글에서 살펴볼 것은 <em>Screen-Space Ambient Occlusion(SSAO)</em> 기반의 <em>HBAO+</em> 라는 라이브러리에 대해서 알아볼 것이다.</p>

<!-- more -->

<p><em>HBAO+</em> 는 NVidia 에서 만든 라이브러리로써, 현재 <a href="https://developer.nvidia.com/shadowworks"><em>ShadowWorks</em></a> 라는 프로젝트에 포함되어 있다. <a href="https://developer.nvidia.com/shadowworks"><em>ShadowWorks</em></a> 에는 <em>HBAO+</em> 뿐만 아니라 <em>ShadowLib</em> 이라는 그림자 렌더링을 위한 라이브러리로써 HFTS, PCSS, CSM 등 많은 기능들을 포함하고 있는 라이브러리가 있다. 현재 <em>ShadowLib</em> 은 오픈소스가 아니지만 이번에 알아볼 <em>HBAO+</em> 는 <em>Github</em> 에서 소스를 받을 수 있다. 이에 대한 자세한 사항은 <a href="https://developer.nvidia.com/gameworks-source-github">“Access GameWorks Source on Github”</a> 에서 확인할 수 있다.</p>

<h3>Ambient Occlusion?</h3>

<p><em>Ambient Occlusion</em> 이란 말은 처음 들어본 사람에게는 생소한 말이지만 한번이라도 들어본 사람들에게는 꽤나 익숙한 말일 것이다. 빠른 이해를 위해 아래 그림을 보자.</p>

<p><br />
<img src="/images/220px-AmbientOcclusion_German.jpg" alt="Wikipedia : Ambient Occlusion Image" class="center-image" /></p>
<center>출처 : <a href="https://en.wikipedia.org/wiki/Ambient_occlusion">Wikipedia : Ambient Occlusion</a>
</center>
<p><br /></p>

<p>가장 위의 이미지를 보자. 단순한 렌더링이 아니라 반사를 구현해놓아서 꽤나 사실적이다. 하지만 여기서 더욱더 사실적으로 표현이 가능하다. 중간의 이미지를 보면 <em>Ambient Occlusion</em> 이 무엇인지 쉽게 알 수 있다. 흰색 물체와 흰색 배경과 함께 아래 구석에 어두워진 것을 볼 수 있다. 이를 <em>Ambient Occlusion</em> 이라고 한다.</p>

<p>글로 간단하게 설명하자면 물체가 모이면 좁은 공간이 생기게 되고, 구석이면 구석일 수록 직접 들어오는 빛은 있으나 반사되어 오는 빛이 적어지므로 어두워진다. 이를 말하는 것이바로 <em>Ambient Occlusion</em> 이다. <em>Ambient</em> 는 주변을 뜻하고, <em>Occlusion</em> 은 무언가 가리는 것을 뜻한다. 빛을 가려서 주변에 보이는 것이 어두워지는 것을 말하는 것이다.</p>

<p>보통 <em>Ambient Occlusion</em> 은 개발시에 미리 시간을 들여 계산해 미리 저장해놓은 다음 실시간으로 저장된 데이터를 읽어서 사용하는 <em>precomputed AO</em> 방식으로 사용한다. 이유는 간단하다. 실시간으로 계산되기에는 요즘 컴퓨터로는 연산량을 버틸 수 없어서 그렇다. 월드가 복잡할수록, 넓을수록, 고퀄리티의 <em>AO</em> 를 계산할수록 시간이 대폭 증가한다. 하지만 이는 물체와 물체간의 <em>AO</em> 를 계산할때의 이야기이다.</p>

<h3>Screen-Space AO?</h3>

<p><em>Deffered Rendering</em> 이 많이 쓰이면서 이를 위한 많은 기술들이 연구되었다. <em>Deffered Rendering</em> 의 대부분의 기술들은 이름앞에 보통 <em>Screen-Space</em> 라는 단어를 달고 나왔다. <em>Screen-Space</em> 란 <em>Geometry Stage</em> 아닌 <em>Rasterizer Stage</em> 로 넘어가서 처리되는 부분을 말한다. 말 뜻대로 해석한다면 2D 이미지의 공간이라는 뜻도 되겠다. 다만 <em>Pixel Shader</em> 로 넘어간다고 해서 <em>Depth(Z value)</em> 가 사라지지는 않기 때문에 이를 온전히 2D 공간이라고도 볼 수는 없다. 실제 좌표계는 <em>Clipping-Space</em> 로 되어 있을 것이다.(x,y,z 가 -1 ~ 1 범위의 좌표로 되어있는 공간, Driver API 에 따라 조금씩 다르다.) 쉽게 이해하기 위해 아래 그림을 보자.</p>

<p><br />
<img src="/images/DeferredLighting.jpg" alt="Deffered Rendering" class="center-image" /></p>
<center>출처 : <a href="http://tower22.blogspot.kr/2010/11/from-deferred-to-inferred-part-uno.html">From Deferred to Inferred, part uno</a>
</center>
<p><br /></p>

<p>위 그림은 <em>Deffered Rendering</em> 의 중요한 특징을 나타내는 그림이다. 이 데이터들을 <em>GBuffer</em> 라고 한다. 저 결과들은 <em>Multi Render Target</em> 을 통해 한 <em>Pixel Shader</em> 에서 나온 결과물들이다. 즉 한 장면을 렌더링해서 2D 버퍼안에 데이터들을 픽셀별로 저장한 것이다. 각각 저마다 필요한 정보들을 담고 있다. 우리가 알아볼 <em>Screen-Space AO</em> 또한 이런식으로 데이터를 처리한다. 위 그림에는 나와있지 않지만 하드웨어 차원에서 <em>Depth Buffer</em> 를 지원한다. <em>Pixel Shader</em> 를 실행한 후 알아서 <em>Depth Buffer</em> 에 Z 값을 저장해준다. <em>Screen-Space AO</em> 는 <em>Depth Buffer</em> 를 이용하여 계산한다. 물론 <em>Depth Buffer</em> 뿐만아니라 <em>GBuffer</em> 에서 <em>Normal</em> 데이터까지 사용하여 할 수도 있다.</p>

<p>하지만 <em>SSAO</em> 는 정공법이 아니다. 모든 <em>AO</em> 를 표현할 수 없으며 디테일한 <em>AO</em> 밖에 표현하지 못한다. 그렇기에 이는 부가적인 방법으로 사용되어야 한다. <em>SSAO</em> 를 활용하기 가장 좋은 장면은 화면에서 작게 표시되는 오브젝트들이 조밀하게 많이 있을 떄나 그려지는 오브젝트의 디테일이 많을 때다. 이럴때 <em>SSAO</em> 를 표현하면 괜찮은 결과가 나온다.</p>

<p><br />
<img src="/images/0cf69542-8ff5-422a-8d01-f11bd65ab62e_scaled.jpg" alt="Unity Technology : SSAO" class="center-image" /></p>
<center>출처 : <a href="https://forum.unity.com/threads/ssao-pro-high-quality-screen-space-ambient-occlusion.274003/page-5">Unity Forum</a>
</center>
<center></center>
<p><br /></p>

<p>게임에서는 조금이라도 복잡한 메시를 쓸 수 밖에 없기 때문에 결국 왠만한 게임에는 <em>SSAO</em> 를 넣는 것이 괜찮은 선택이 된것이다. 하지만 초기에 제안된 <em>SSAO</em> 구현물들은 대부분 꽤나 시간을 잡아먹었었다. 그래서 시간에 따른 선택이 되었지만 <em>HBAO+</em> 와 같은 개량된 기법이 여러개 등장하여 퍼포먼스를 다른 곳에 쓸 수 있게 되었다. <a href="https://www.geforce.com/hardware/technology/hbao-plus/technology">Geforce : HBAO+ Technology</a> 에서 <em>SSAO</em> 테크닉에 따른 벤치마킹을 볼 수 있다.</p>

<p><br />
<img src="/images/hbao_bench.png" alt="benchmark" class="center-image" /></p>
<center>출처 : <a href="https://www.geforce.com/hardware/technology/hbao-plus/technology">Geforce : HBAO+ Technology</a>
</center>
<center></center>
<p><br /></p>

<p>우리가 살펴볼 것은 가장 아래에 있는 <em>HBAO+</em> 에 대한 것들이다. <em>Resolution</em> 은 <em>Depth Buffer</em> 의 해상도를 뜻한다. 당연히 큰 사이즈여야 디테일한 것까지 표현할 수 있다. 가장 왼쪽에 있는 것은 시간이다. <em>HBAO+</em> 가 2.4ms 로 조금 느리지만 그 오른쪽에 있는 <em>Occlusion Samples Per AO Pixel</em> 의 숫자와 같이 비교하면 이야기가 다르다. 이는 한 픽셀별로 몇번 다른 텍스쳐의 데이터 샘플링 숫자다. <em>HBAO</em> 는 4번만 하지만, <em>HBAO+</em> 는 이의 9배인 36번이다. 샘플링을 많이하게 되면 더욱더 사실적인 <em>SSAO</em> 를 표현할 수 있다. 샘플링 숫자에 비하면 시간은 내어줄 수 있는 자원인 것이다.</p>

<p>이 글에서는 <em>HBAO+</em> 를 분석하기 전 배경이 되는 개념에 대해서 알아보았다. 다음 <a href="/2017/11/15/hbao-plus-analysis-1">hbao plus analysis 1</a> 에서는 <em>HBAO+</em> 라이브러리에 대한 본격적인 분석을 해보려고 한다.</p>

<h1>참조 자료</h1>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Ambient_occlusion">Wikipedia : Ambient Occlusion</a></li>
  <li><a href="https://developer.nvidia.com/developer-program">NVidia Developer Program</a></li>
  <li><a href="https://www.geforce.com/hardware/technology/hbao-plus/technology">Geforce : HBAO+ Technology</a></li>
  <li><a href="https://forums.geforce.co.kr/index.php?document_srl=12616&amp;mid=geforce">한국 지포스 포럼 : HBAO+</a></li>
</ul>

  </div>

  
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://zizon.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</article>

      </div>
    </main>
    
    <script>
      $("script[type='math/tex']").replaceWith(function() {
          var tex = $(this).text();
          return katex.renderToString(tex, {displayMode: false});
      });

      $("script[type='math/tex; mode=display']").replaceWith(function() {
          var tex = $(this).html();
          return katex.renderToString(tex.replace(/%.*/g, ''), {displayMode: true});
      });
    </script>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a><br />
&copy; 2015&ndash;2021 - <a href="/about/">Su-Hyeok Kim</a> - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://hrmrzizon.github.io/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
